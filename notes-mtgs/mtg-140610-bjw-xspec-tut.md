XSPEC notes and set-up from tutorial with Brian
===============================================
Aaron Tran
Tuesday June 10, 2014

So I walked into Brian's office around 5:30, sat with him for ~1/2 hr as he gave me a short intro to XSPEC and basic setup commands.  Yay.  Cleaned up these notes on Wednesday, June 11.

Starting commands
-----------------

The output of CIAO's `specextract` is a number of `.pi` files.  These are exactly the same as the default `.pha` files used by XSPEC, only drawback then is that you must specify the extension

    data filename.pi    # Automatically finds arf/rmf/bkg whatever files
    cpd /xw             # Change Plot Device to x11 window
    plot data           # Plot the data
    setplot energy      # Change x-axis to energy (keV default)
    plot data           # Regenerate the plot
    ignore **-0.5,7.-** # Set plot domain (ignore/notice)
    plot ldata          # Replot, with log-scaling on y-axis
                        # Use `notice all` to recover ignored channels

Comments:
* Chandra nominally ranges between 0.25 keV and 10-12 keVish,
  but the data are not so great (hence the ignore ...)
* XSPEC accepts a number of abbreviations, basically out to the letters
  needed to specify a unique command, e.g., `setplot en`, `plot ld`, etc.

XSPEC uses some old atomic data, so run the command:

    xset neivers 2.0

nei = non-equilibrium ionization, useful for calculating plasma temperatures and stuff...?  Apparently a new version of neivers is coming out soon too.


Sidebar on SN spectra
---------------------

Brian pulled up some data on N103B, which he did a press release on at the recent AAS meeting:
[AAS abstract](http://adsabs.harvard.edu/abs/2014AAS...22441204W),
[JPL release](http://www.nasa.gov/jpl/spitzer/supernova-20140604/).

N103B's spectrum looked very different than my test spectrum of thermal emission in Tycho.  It's ~2x older in actual age, but its dynamical age is much older because it's expanding into denser circumstellar material (CSM) (from which they can infer properties of the progenitor system).  So, N103B has a lot more iron emission and the silicon line is dimmer.

The fall off below ~1 keV is due to heavy metals in the ISM (remember that hydrogen can't absorb any X-rays, they pass right by).  From this, of course, we can infer properties of ISM metals!

The bend at 2 keV is an instrument response, unique to Chandra.  The fit will account for this (instead of fitting the response-corrected data, we fit to a model that incorporates instrument response -- same thing).  Anyway, we expect a pure, beautiful power law synchrotron spectrum, with just that fall off at low energies and the slight bend at 2 keV.

Some of the elemental lines that Brian pointed out: oxygen, neon, iron mush (needs lotsa energy), magnesium, silicon, sulfur.

More XSPEC commands
-------------------

    back none           # Remove background correction
    back spec_bkg.pi    # Reapply background correction
    data spec_bkg.pi    # Try plotting the background spectrum
    plot ldata          # We see background lines!
    show data           # Print out info about currently loaded data

Weak background lines are due to diffuse X-ray emission.

To load multiple spectra...

    data 1:1 spec.pi
    data 2:2 spec_bkg.pi
    show data
    plot ld
    ignore 1-2:**-0.5,7.-**
    plot ld
    # ctrl-D to exit XSPEC


My own additions
----------------

To get help file working (and change other settings),
edit `~/.xspec/Xspec.init`.  I changed the HTML viewer to `open` (preview).

To save plots to files:

    cpd filename.ps/cps  # cps for color postscript, landscape orientation
    plot ldata  # Multiple calls to plot generate multiple pages in ps file
    cpd /xw


Agenda
------

Get spectra from all the regions I got, the rims.  Make sure it's purely nonthermal, purely synchrotron.
If we see traces of thermal lines, we'll have to go back and revise regions, tweak them around.
Then we can move forward with the fitting, that's where we include instrument response (via the response file stuff).

These spectra will help decide if my marked 'iffy' regions are good or bad, as well.

Make a list of to-dos, but you basically wanna have XSPEC stuff generated by tomorrow.
* Revise regions to omit thermal stuff (have two sets on hand, label appropriately)
* How to script XSPEC to make spectra automatically/easily?
* Generate spectra for good regions
* Generate spectra for iffy regions
* Catalog bad regions somehow, for later use
* Meanwhile! read about synchrotron emission, read Ressler paper...
* Run `chandra_repro` on other, shorter observations (I want to investigate that funky object...)



