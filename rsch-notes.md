Research notes
==============

Aaron Tran
Summer 2014

This is a running log of thoughts, actions -- a lazy man's lab notebook.


Monday, 2014 June 2
===================

* Morning NASA orientation
* Meeting with Rob Petre until about 1-2p?
* Not much work done (I can't even remember what I did...)
* CRESST orientation


Tuesday, 2014 June 3
====================

Summary
-------

* Installed ds9 to ~/bin. In `.bash_profile`, add: `export PATH=~/bin:$PATH`
* Messed around on ds9, went through user's manual.  Played with ds9 commands.

Agenda, useful items?
---------------------

[ds9 command line options](http://ds9.si.edu/ref/command.html) will be useful
Looks like we need pyds9, or XPA, for consecutive commands...

Need to cover, for my own learning
1. basic radiative processes (thermal, nonthermal emission)
2. supernova physics (temperatures, radiation/spectra during evolution)
3. physics of Tycho -- interpretation of the fluff.  ISM gradient.
4. Ressler et al. (in press, ApJ)

5. X-ray telescopes.  Resolution, operation, limitations

whether in some kind of lab notebook, LaTeX file, or whatever

Meanwhile: construct and save shape files of the regions for which to extract
spectra.
1. Make a preliminary region, just eyeballing it / doing it by hand
2. Read Ressler.  Look at any similar papers where people look at filament
   spectra
3. Figure out if there's any more systematic way.  How far beyond the shock, or
   interior of the shock, should the region extend?  Physics motivating this.

Main Tycho (SN 1572) data
-------------------------

All files have been generated by Brian, sent to Rob.
He's already done the processing work with CIAO etc...

Three data files are:

* `0.7-1kev_mosaic.fits`
* `1-2kev_mosaic.fits`
* `2-7kev_mosaic.fits`

Resolution: 1 arcsecond (downsampled, Chandra has 0.5 arcsec resolution).
To verify this, poking around in DS9 (looking at pixel coords):
* RA:  0.98 arcsec = 0.150 seconds * (360 deg/24 hr) * cos(64.167 deg)
* DEC: ~1.0 arcsec

We also have `2009_3to7kev.fits`, resolution is 0.5 arcsec (very few counts)

Meddling with ds9
-----------------

Generating an RGB image using these images may be useful to help,
e.g., identify thermal contamination using all bands.

Scaling limits: goal is to simply reject background.
Method: look @ heatmap -- SNR should be ~pure white, background is colorful.
Mainly, we lose some information about high count pixels
(only O(10^1) pixels will thus saturate)

* 0.7-1 keV: 4e-8, 2.1e-6
* 1-2 keV:   4e-8, 2.42e-6
* 2-7 keV:   3e-8, 1.5e-6

Example "one-liner" for an RGB image (modified Jun 4):

    ds9 -rgb \
        -red 0.7-1kev_mosaic.fits \
            -scale limits 4e-8 2.1e-6 \
        -green 1-2kev_mosaic.fits \
            -scale limits 4e-8 2.42e-6 \
        -blue 2-7kev_mosaic.fits \
            -scale limits 3e-8 1.5e-6 \
        -rgb lock scale yes \
        -asinh

For a single file:

    ds9 2-7kev_mosaic.fits \
        -scale limits 4e-8 2.1e-6 -asinh -cmap Heat

Qualitatively:
* sqrt is useful to bring out thin/wispy filaments (bottom-left / SE corner)
* asinh, histogram eq. are useful for contrast, dramatic nice pictures.
  Can definitely see stripping, little wisps, esp. in 2-7 keV

sqrt makes low energy stuff slightly brighter, asinh makes high energy stuff
brighter.  In general, both serve to pull out low energy detail, and brighten
high energy stuff (closer to saturating).  Hist. eq. does this even more
extremely, it seems.

Radial profile selection with ds9
---------------------------------
Region specification:

    projection x1 y1 x2 y2 width

(x1, y1) and (x2, y2) specify coordinates of bounding box, I suppose

My next question is how do you specify a width?



Wednesday, 2014 June 4
======================

Summary
-------
* Began selecting regions for fits
* Met with Rob about next plans
* Laid out next steps (for processing fits)
* Found strange object inside Tycho

Selecting regions
-----------------

Setup command for generating projection regions:

    ds9 -rgb \
        -red 0.7-1kev_mosaic.fits \
            -scale limits 4e-8 2.1e-6 \
        -green 1-2kev_mosaic.fits \
            -scale limits 4e-8 2.42e-6 \
        -blue 2-7kev_mosaic.fits \
            -scale limits 3e-8 1.5e-6 \
        -rgb lock scale yes \
        -histequ

Note that order matters here -- lock the scale after setting limits in each
channel, so they will all have different limits.

Agenda for now
1. Get some rough guesses / shapes / regions to save, by eyeballing...
2. Figure out how to generate plots from those regions automatically.
3. Think about calculating ``radial distance''.  How do we get the center?
    a. Centroid of gamma-ray emission given by (Acciari et al., 2011).
       But, this is offset by 0.04 deg. = 2.4 arcminutes
       Compare the remnant diameter ~0.14 deg. = 8.4 arcminutes
       Eyeballing from mosaic fits file, center is abt:
       (RA, dec) = (00:25:17, +64:08:00) (+/- 3 sec RA, +/- 30 arcsec dec)

Projection drawing
------------------
Just initial guesses, to save/play with.

See notes file in data/

Sanity check: if I generate a region and save/reload, will it have the right
rotation? How is this saved with only two points?
Answer: if I save in ds9 format, it appears to store a "thickness" as well.
The "thickness" direction is determined by the ordering of the two points,
so the region's orientation is fully specified.
Yes: projection(x1,y1,x2,y2,width), width is "thickness", great.

When thinking about region sizes/counts:
* SN 1006 has diameter 0.5 deg., vs. ~0.14 deg. for SN 1572
* But count rates are much higher for SN 1572

Pulsar-looking thingy!! (brief diversion)
-----------------------------------------
Whoa!

Thing that looks like Crab Pulsar, located at:
RA, dec = 00:25:00.1, 64:10:44 (hr, deg.).  
Most visible in power scaling, also sinh.

* Rest frequency is between 1-2 keV, assume 1.5 keV --> 3.63e17 Hz.
* Redshifted stuff, 0.7-1 keV, assume 0.85 keV --> 2.06e17 Hz.
* Blueshifted stuff, 2-7 keV.  Don't know this (too large range).

Red frequency shift is 1.57e17 Hz.
From Doppler formula we can get the redshift as:
`(3.63 - 1.57) = (c - v)/(c + v) * 3.63`.
Velocity projected along line of sight is ~0.28c... wow.

Flip to solve for frequency of blueshifted material:
`(3.63 + \Delta f) = (1+0.28)/(1-0.28) * 3.63`
Blue frequency shift is 2.8e17 Hz,
thus blueshifted stuff has freq. ~6.4e17 Hz --> 2.6 keV.

Coooooooooool. But I don't know how to find further information, yet.

Next steps in region processing
-------------------------------

Ask about what we should see after the shock?  Hard to see whether present, or
thermal emission, or what.

* Run around SNR in each band, to check for any spots I missed, and note
  previous regions that look contaminated (in each band).
* Check each region individually for (1) clean in all bands, (2) long enough in
  front and back for fitting.
* Sort the filaments -- get the obviously good ones, then figure
  out how to make use of the blah and bad ones.  Which ones will we use?
* Background subtraction (compare local vs. global background).  I see two ways
  to approach this part.
  1. For each region, have enough extending outwards to estimate immediately
     nearby background.  Subtract mean from each spectrum (in each band
     separately, of course...)
  2. For entire image, we could get a thorough background spectrum (mask the
     SNR, apply a threshold and/or remove point sources [prefer latter to avoid
     losing information]).  Because background spectrum should have frequency
     dependence, this may be important when we generate spectra (checking for
     contamination/other effects).  But, binning in energy integrates over the
     frequency dependence.  So profiles just need a constant shift (?).
* Generating spectra and checking for contamination

2nd order stuff (nice but less important)
* Optimization
* Calculate *expected* curvature based on width of regions
  (idea, could quantify how wide these may be. But, multiple filaments likely
  to be a larger confounding effect)
 

More reproducible / automated profile region selection
------------------------------------------------------

Idea: try testing projections for minimum peak width, e.g. using pyds9.
    or, find when peak height is maximized

Supply initial guess regions, then rotate them about their centers (?) until
the filament peak width is minimized.  You should generate the projections in a
consistent way (just for ease of use/manipulation), e.g. starting from outside
and moving in.

(remember that we get THREE projection plots out, one for each band...)



Thursday, 2014 June 5
=====================

Summary
-------
* Finished selecting regions, color-coded by quality.
* Installed CIAO 4.6 on my computer (omitted HRC background event files)
* Installed ftools, XANADU (incl. XSPEC), XSTAR (HEASOFT 6.15.1)
  from pre-compiled binary
* Installed pyds9, Python interface to ds9 via XPA
* Created script to extract and plot profiles from ds9, using pyds9 interface

ciao4.6, ds9, heasoft-6.15.1 are all installed to `~/bin/`.
For heasoft, I had to use `./configure PERL=/usr/bin/perl`
to prevent Perl mismatch.

Note for background removal -- the black region outside the SNR is absolutely
not uniform -- there is a trend of decreasing counts towards the edge of the
image.

Agenda review
-------------

1. Re-do/tweak regions (wait for higher res images from Brian?)
    * Manual tweaking, see what Rob/Brian say
    * Possible optimization w/ pyds9
    * Check curvature?
2. Background subtraction (wait for discussion / how-to)

So now I want to generate plots of the counts (for first pass
review/discussion), and also start reading up and learning abt supernova
physics anyways (prepare for next stages).

Meanwhile I am installing the various software packages.

Extracting profile parameters using ds9's projection tool
---------------------------------------------------------

Whenever I change the current frame in an rgb image, all the projection plots
are automatically regenerated.  This was very annoying at first, but now I
can exploit this to get the plot data -- as I could not find a way to run the
analysis commands via pyds9/xpa!

:)

Please see iPython notebook in `data/`

TODO for FRIDAY

Improve plot quality (set .matplotlibrc or whatever)
Sort plots into good/bad/whatever


Friday, 2014 June 14
====================

Summary
-------
* Set up boilerplate plotting functionality (improve matplotlib defaults)
* Sent email to Rob/Brian with regions, plots, notes
* Started reviewing Jackson on synchrotron radiation (ch. 14)

pyds9 version of set-up code
----------------------------
Here we go...

    import ds9
    d = ds9.ds9()
    d.set('rgb')
    d.set('rgb red')
    d.set('file 0.7-1kev_mosaic.fits')
    d.set('scale limits 4e-8 2.1e-6')
    d.set('rgb green')
    d.set('file 1-2kev_mosaic.fits')
    d.set('scale limits 4e-8 2.42e-6')
    d.set('rgb blue')
    d.set('file 2-7kev_mosaic.fits')
    d.set('scale limits 3e-8 1.5e-6')
    d.set('rgb lock scale yes')
    d.set('scale histequ');

Agenda for today
----------------
* Twiddle with profile plots/scripts and send regions/plots/notes to Rob/Brian
* Twiddle with CIAO's specextract, just playing now
* Call abt NASA computer access? / email?
* X-ray mtg + GSFC colloq on geodesy (that's probably ~2 hr of your day...)
* Self-study of SNR physics, read Ressler paper

Notes
-----
CIAO looks a little tricky / not so interactive, probably could use some
feedback from Rob/Brian first.  I think learning about SNRs is higher priority
now, so I can better use CIAO/XSPEC/etc later on.

Currently I am setting up some boilerplate plotting material:

1. ~/.matplotlib/matplotlibrc
2. my own `fplot` module for matplotlib. This just prints the settings in use,
   intended for iPython notebooks or similar.  Maybe I can add more utilities
   later.

Okay, not perfect, but looks passable for now.

Sent email to Rob/Brian with regions, annotated regions/labels on Tycho image,
plots of radial intensity profiles, pictures of strange pulsar-like object.



Monday, 2014 June 9
===================

Summary
-------
* Meeting with Brian to look at region picks
* Wrote script (`ds9proj2box.py`) to convert ds9 region files to CIAO
  region files (aggressively made it usable).

What's the agenda for today?  Do some self-study / reading until meeting with
Brian at 11am... then see what to do (start messing with CIAO?).

(some reading about synchrotron radiation / bremsstrahlung ensues)

This is kind of inefficient to be honest.  I guess this is probably low
priority, but I need to pick this up more efficiently...  Do some problems.
Get an intro level astrophysics textbook `w__w`.

Meeting with Brian
------------------
Regions -- just start with 10-12 best ones for now.  Make sure they're good in
all three bands (certify this).

Run `chandra_repro` on raw data
Run `specextract`

We only need 176 kilosec. (longest obs) to check spectra for contamination.
obsID is 10095, `package_1531_140609112030.tar`

Yes, we are using Hughes' 2009 (750 ks) observation.


Work now
--------
Check that the "good" regions are good in all three bands.
Obtain spectra for these regions (and check the funny object while you're at
it) using CIAO.

Now writing script to convert DS9 projections into boxes.

Wow that took way longer than it was supposed to.
1. too sleepy at work...
2. figured out...
    * I don't need great circle formulae (linear approx)
    * Stupid me, RA and dec don't map cleanly onto x-y
    * Rewrite to use physical coords (interface with ds9 to generate and get
      rid of intermediate files)

Some pythonic reminders: to work with files, use:

    with open(...) as f:
        for line in f:
            print line
        # or if writing
        for line in stuff_to_write:
            f.write(line)

Regex is great... but you need to keep in mind the tools in your arsenal, and
reach for the right ones.  I guess it will take time.

Remember to move things to scripts, when needed (i.e., if I have to use a
script more than 1x or 2x?).  Use sysargv.

CIAO wants files in physical coordinates
(see, e.g., [this thread](http://cxc.harvard.edu/ciao/threads/regions/index.html#formats))


Tuesday, 2014 June 10
=====================

Summary
-------
* Read CIAO threads on `chandra_repro`, `specextract`
* Reprocess longest single observation (~176 ks, ObsID 10095)
* Troubleshoot specextract with Brian, generate test spectra
* XSPEC tutorial with Brian

Okay, now that I've got the region file conversion working...
onto generating stuff with specextract

CIAO reprocessing
-----------------

Now running `chandra_repro verbose=5` (it seems like it will take a while) on
the 176 ks observation (obsID 10095).
Finished abt 1 hr, 4 minutes later (`acis_process_events` took ~50 minutes)

    WARNING: Observation-specific bad pixel file set for session use:
        /Users/aarontran/Documents/snr-research/data/chandra/
        10095/repro/acisf10095_repro_bpix1.fits

    Run 'punlearn ardlib' when analysis of this dataset
    completed.

    The data have been reprocessed.
    Start your analysis with the new products in
    /Users/aarontran/Documents/snr-research/data/chandra/10095/repro

Meanwhile I start reading about specextract.

CIAO specextract
----------------

To use a stack, input
`pset specextract infle="acisblah.fits[sky=@../thing.ciaoreg]"`
instead of using the `region(..)` syntax.
But, specextract also demands a stack of equal size for `bkgfile`.

On the flip side, it may be more sensible now to select backgrounds near the
radial profiles themselves, instead of using this mega-thing that will take
forever to run.

Sequence of specextract commands
--------------------------------

    punlearn specextract
    pset specextract \
        infile="acisf10095_repro_evt2.fits \
               [sky=region(../../../thing_tycho.ciaoreg)]"
    pset specextract outroot=extracttest/spec
    pset specextract \
        bkgfile="acisf10095_repro_evt2.fits
                [sky=region(../../../background.ciaoreg)]"
    pset specextract verbose=2

    # These are already set by default
    pset specextract weight=yes
    pset specextract weight_rmf=no
    pset specextract combine=no

    # Ancillary files: aps, mskfile, badpixfile
    # should be automatically found

    # Not set yet cuz I'm clueless
    # energy_wmap, grouptype, binspec, bkg_grouptype, bkg_binspec

    plist specextract
    specextract

What's this `mode=h` stuff, that shows up?  Some threads explaining how to use
`chandra_repro` and `specextract` have this additional flag, but I can't find
its documentation.  Maybe a legacy thing.

This does take a little time, even though just a small region... the background
region was very large, maybe that's a bad idea.
Started around 12:28-12:30pm, 
Stopped at 13:47pm -- this is taking really long.  Could be because I locked my
screen to go grab lunch meanwhile, if that messed it up
It was stuck on mkwarf (made it through sky2tdet after a lonnnnng time)

Try again at 13:58pm.  Stop at 14:24, it's still sitting on mkwarf

Background region
-----------------
There is a decrease in counts away from the SNR, I'm not sure if this is
physical or not (or if this should be accounted for by `chandra_repro`, which
it might not be here).

One thing I could do is to take two concentric annuli of the background, to see
if the spectrum changes as a function of radial distance.

New profiles with 0.5" binning
------------------------------
I.e., no binning
Just re-run script (should get scale limits again)
The new plots look good.

Talked to Brian
---------------
Some troubleshooting:

1. the region I'm extracting spectrum from has too many counts (2 orders of
   magnitude more than, e.g., along rims)
2. background region is way too big -- you want to stay nearby.  How to tell
   quality of background region?  Eyeball... at least hundreds, thousands of
   counts to get a decent spectrum.  We'll look in XSPEC and see how it goes.
3. Idea: just generate a few background circles around the rims, then assign
   each background region to several nearby profiles.
4. Brian can send files with just count numbers, instead of intensity units,
   so I can mess with them / play with them.
5. Download Funtools for DS9, there's a way to get it to load in the menus of
   DS9 by default.
6. Some stuff in CIAO can run in parallel, take advantage of multiple cores.
   Not sure about specextract... (from skimming the page)

Brian explained that the program is generating a response function... response
matrix function or whatever.  Captures the chip's spatial and frequency
response, but must be generated on the fly each time, it's a multiplicative
process.

ALSO, MEETING TOMORROW BEFORE COFFEE/COOKIES THING, PROBABLY AROUND 9AM OR SO
WAKE UP EARLY, SLEEP EARLY, SEND STUFF INTO JVGR EES ASAP...

Trying again, using `testspec.ciaoreg` and `testspec_bg.ciaoreg` (smaller, both
nearby, looking at thermal emission).  Let it run -- and it finishes within a
few minutes!  Very snappy.

Move on to working with XSPEC, stop by Brian's office if
I get it to work! (and he can get me started)

Meddling with spectra
---------------------

I have the following files from a single run of `specextract`:

* `spec.pi`
* `spec_grp.pi`
* `spec_bkg.pi`
* `spec.arf`
* `spec.rmf`
* `spec_bkg.arf`
* `spec_bkg.rmf`

So we have a source spectrum, a grouped source spectrum,
and a background spectrum (`.pi` files).
Then we have weighted response files, for background as well.

REMEMBER, when starting xspec stuff (`heainit`), start before starting CIAO if
you are running in the same session, due to conflicts with parameter files.

See meeting notes for Brian's XSPEC tutorial!


Wednesday June 11
=================

Summary
-------
* Generated "cutback" good regions and test spectra with specextract, XSPEC
  (this took a long time, ~50 minutes for 10 regions + backgrounds)
* Meeting with Rob and Brian -- looked at spectra, discussed subsequent fitting
* Cleaned up files, try to make log more readable in future

Quick list of to-dos
--------------------

Due to the JVGR paper (and time mismanagement yesterday night)
I started actual work today ~12pm, quite late.  So I will be staying
late today, and pounding away to learn Tcl, XSPEC.

For now, what do I need to prepare for the meeting?  I won't be able to throw
together scripts for everything, yet (which I can mention). We need to:

1. assess quality of good and okay region files (plots/profiles already
   generated) (done, but need to do same using spectra)
2. draw up new "good" regions without the background thermal stuff (done)
3. draw up new "okay" regions without the background thermal stuff
4. run `specextract` on the good regions (okay regions too if time)

Cutback regions + background regions made, and converted to CIAO regions
(remember to use script for projection-type regions).

Meeting with Brian and Rob
--------------------------

Showed the spectra for the good regions, nonthermal emission.

Feedback on regions and spectra:

* Region 4 (next to the orange tuft) is really contaminated, welp.  Not gonna
  work.  If that was the only region we had available, then maybe... could try
  to subtract off stuff in the back.  But no, too much trouble.
* Region 3 (wispy NE filament) has some line emission.  Twiddle with the box
  and try to make it better!
* Need to document all of this stuff -- explain what's going on, where we
  looked, what we tried and did.

Looked at some of the southern regions -- yup, contamination is a problem.  I
didn't have spectra for those yet though.

Another extension (different project): something they worked on with another
remnant was to look at the precursor.  Electrons could diffuse ahead of the
shock, give rise to a squished out rim.  Here we are seeing very sharp rim
edges, which constrains some of the physics of those rims.

Iterative sort of process now -- adjust the region, check the spectrum and see
if you can get the Si line to go away.  Rinse and repeat (and log what you're
doing).  Take good notes -- when I'm gone they have to be able to say, "We
checked x region and it looked bad/good for y reason".  So log the bad
regions, log all the region twiddling.

Next step -- fit the spectra to a power law and verify that they look good.

* Power law is a strictly empirical model of course, but simple.  Don't care
  about the actual parameters, as long as it fits it's okay.
* `srcut` is a fitting model in XSPEC -- you supply a radio flux (at 1 GHz)
  and radio spectral index, then fit for the cut-off energy
  (and the spectral index after the knee is determined???).
  So you only get like one or two free parameters.
  Rooted in the physics very nicely, but more hassle.  Especially as radio
  telescopes just don't have the necessary resolution.

Amusingness: apparently Nina is working on the pink fluff, idea is to try
getting the Doppler velocities and constructing a 3-D map.  So we're dividing
and conquering on these supernova remnants.  Nina arriving Monday, can help get
her started on DS9/CIAO/HEASOFT stuff (Rob will cc on email).

Computer is still a question mark, Rob/Brian came to take a look a bit after
the meeting.

So I was underprepared for that meeting, not as much to discuss/present
unfortunately.  Not as many questions going in.

Funtools install
----------------
Installed Funtools 1.4.4 to `~/bin/saord/`.
Made some productivity tweaks (set-up MacVim so I can use splits etc.)
Research notes organization ---------------------------

To better organize my thoughts/work, and reduce clutter in this log file.
(although granted I'm tired right now, I'm having a hard time keeping track of
what needs to be done for research)

1. Create file for code pipeline (list commands that need to be run).
   Will store 1. commands, 2. make evident where I need scripts
2. Create a running agenda

Currently brain-dead (~7pm), I'm going to get food, come back, nap, and maybe
try working through the night.

Looking at all the spectrum plots now:
Regions 1, 3, 5, 6, 8, 9, 10 all have a weak Si line
Regions 2, 7 look relatively clean
Region 4 is very contaminated!  (could try splitting)

Of these regions, 5, 10 look to be a bit noisier.  But not terribly so.
Next, cutback regions for the OKAY/BAD regions, then spectra.


Thursday 2014 June 12
=====================

Summary
-------
* Experimented with specextract pipeline, figured out how to manipulate files
  and headers.  Some fiddling with XSPEC, and XSPEC model fitting, as well.
* Set up new computer!  This took a little while...
* Updated/improved script for making profile plots, made 0.5 arcsec resolution
  plots for all regions (good/iffy/bad)
* Made new background regions, to cover all possible regions
* Formulate pipeline for region/background processing and improvement
* Draft code for specextract scripting


Specextract pipeline
--------------------

New game plan: run specextract on the profiles and backgrounds independently,
and then link them together after the fact.  No redundancy.
From one test: run `specextract` and generate spectra for 1) lone region,
2) lone background, 3) region + background correction; then manually create
4) lone region linked to background using CIAO's `dmhedit`.
The linked spectra and the files all looked good!

(for `dmhedit` commands, see the end of this
[thread](http://cxc.harvard.edu/ciao/threads/extended/index.html#stepbystep)

Useful tools: fv (gui to interact w/ fits files), fdump (dump to plaintext!).
And, remember to use `fhelp name_of_ftool`


Back to ds9 regions
-------------------
Need to look at good/iffy regions and assess amt of thermal contamination.
Then move forward with fitting (1. fit power law, 2. profile fitting)
Updated script for generating profile plots
Now scripting the spectrum generation


Background regions around SNR
-----------------------------

Considerations when selecting background regions:
* CCD chip boundaries!  Visible in RGB image, w/ log scaling
  (bars of anomolously increased counts, cutting across the SNR)
* Point sources, most often in red (0.7-1 keV) or blue (2-7 keV)
* Get as close to SNR as possible
* Try to keep background region sizes similar
* Background regions should be larger than profiles -- to account for much
  smaller number of counts
Generally, use log scaling when drawing boundaries to reveal point sources.

I picked a good number, looking at `profiles_all.reg`.  I may revise them
though.


iMac computer setup
-------------------

New iMac arrived in the afternoon! Spent some time downloading files / setting
up various customizations.  In general I am installing most astro software
to `~/bin/`.  This should be added to `$PATH` in `.bash_profile`.

1. Set Finder, Firefox/Chrome, Terminal preferences (using bash right now...)
2. Set System Preferences (remap Caps Lock key to Ctrl)
3. RC files -- the following ones were imported / set-up

    .bash_profile
    .screenrc
    .vimrc
    .vim/colors/vividchalk.vim
    .matplotlib/matplotlibrc  # UPDATE after 
    .xspec/Xspec.init  # Just need to change the help doc viewers

4. Software:
    * MacVim (update `.bash_profile` alias accordingly)
    * TextMate (enable shell support for `mate` in preferences)
    * XCode (+ command line tools in preferenes)
    * homebrew (compared to macports, doesn't need sudo?)
    * Anaconda (Python distribution with numpy/scipy/matplotlib/iPython/etc.)
    * MacTeX
    * XQuartz (X11 windowing system, needed for subsequent astro software)
    * ds9, pyds9, Funtools
    * CIAO, HEASOFT

I think that is everything necessary so far... we'll see what else comes up.

Friday 2014 June 13
===================

Summary
-------
* Reviewed "good" region selection, created new set of good regions
  (see notes in `data/notes-profiles.md`)
* Ran specextract on new good region selection (17 regions, ~45 min.)
* XSPEC fitting tutorial with Brian
* Mike Werner's Spitzer colloquium (lots of cute/neat science)
* Created script to link regions and background spectra

Meet with Brian today!

Spectra organization
--------------------
Writing script to link backgrounds with regions.
See `pipeline.md` for details.

    data/
    data/spectra/bkg
    data/spectra/good-1
    data/spectra/good-2


Monday 2014 June 16
===================

Summary
-------

* Linked spectra together (`spec_linkbg.py`, `spec_clearbg.py` working)
* Software setup w/Nina (derp derp)
* Drafted script to parse spectra and output plots with PyXspec
* Started reinstalling/troubleshooting HEASOFT install, to get
  PyXspec functionality.


Spectra manipulation
--------------------

Linked spectra in `data/spectra/good-2` to backgrounds in `data/spectra/bkg`
I accidentally messed up the order of arguments to `spec_linkbg.py`
So, I created and executed `spec_clearbg.py` to clean up the BACKFILE entries
for the files in `data/spectra/bkg`.

Fiddling around with XSPEC's commands `identify`, `setplot id`, looking at
spectral line output/information

PyXspec setup -- HEASOFT reinstall
----------------------------------

YES, BEAUTIFUL, THERE IS SUCH A THING AS `PyXSPEC`... makes life easier.
Only possible issues: no implementations of commands: hardcopy, identify.
But I think we'll be okay.

Issues: binary installation of HEASOFT doesn't have the necessary PyXspec
files.  And, there may be trouble finding development header files:

* python is in `/opt/local/.../2.7/bin/python2.7`
* Python.h is in `/opt/local/.../2.7/include/python2.7/Python.h`
* libpython2.7.dylib is in `/opt/local/.../2.7/lib/libpython2.7.dylib`

where `...` shortens `Library/Frameworks/Python.framework/Versions`.
(use `find /opt/local -name [libpython*, Python.h]` to locate)
It should work as it searches relative to the executable's location.
And the configure didn't fail or anything.  But if this is an issue, add
symlinks to the relevant files...


HEASOFT reinstall
-----------------

Reinstall HEASOFT 6.15.1 from source as follows:

    export PERL=/usr/bin/perl
    export FC=gfortran-mp-4.7
    ./configure --prefix=/Users/aarontran/bin/heasoft-6.15.1/

This required:
1. reinstall MacPorts gfortran w/ 32-bit compatibility
   `sudo port install gcc47 +universal` (this takes a while...)
2. Two issues with MacPorts install of Python: could not find library/header
   files (`Python.h`, `libpython2.7.dylib`), and is 64-bit only.  Solutions:
   1) use Apple's Python with `sudo port select python none`.
   2) reinstall Macports Python with `sudo port install python27 +universal`
3. While building/making resource-intensive packages, run:
   `sudo mdutil -a -i [off/on]` to toggle Spotlight indexing.

If using Apple Python, the following issues occur:
1. need to issue bash command `export VERSIONER_PYTHON_PREFER_32_BIT=yes`
   in order to use PyXspec
2. Apple Python doesn't have matplotlib/scipy/other packages set-up
3. Not the version of python used by ipython

If using Macports Python (reinstalled with +universal flag):
1. need to issue command `arch -i386 [i]python` to run PyXspec
2. matplotlib/numpy/scipy aren't 32-bit compatible

Dammit.

Conclusion: PyXspec scripts must be run as, essentially, standalone scripts.
Saved output from said scripts can be passed to other scripts, which use 64 bit
Python.  Not much better than Tcl scripting and I burned about 8 hours on this.

On the bright side, PyXspec is pretty convenient!


Tuesday 2014 June 17
====================

Summary
-------
* Finished HEASOFT reinstall (notes above, merged with yesterday)
* Reviewed "good-2" set of regions for quality

Back to region quality review/inspection.  I now have:
1. spectra with fit parameters and a chi-squared
2. profile plots
3. RGB image of Tycho
to help evaluate the quality of all the selected regions. So I walk through
all the data and determine where else to adjust regions / pare down test/bad
regions.


Wednesday 2014 June 18
======================

Summary
-------
* Started installing software on iMac (see install log there)
* Cleaned up `regions-good-2.reg` and made `regions-good-3`.  See
  `notes-regions.md` for information on region rejections / twiddling.
* Ran pipeline on `regions-good-3` -- first complete test of pipeline.


Region (`regions-good-3`) selection
-----------------------------------

move backgrounds farther away and see if things change....
Start profile fitting.

Compile the fit statistics for all the regions.
Set up the computer...


Thursday 2014 June 19
=====================

Summary
-------
* Fixed HEASOFT install on iMac, and matplotlib/iPython problems with libpng
* Generate `background-2` regions and link spectra (`good-3`)
* Some reading about synchrotron rim physics (Cassam-Chenai, 2007, etc.)
* Began profile fitting.  Tested a two-exponential model with middling results


Friday 2014 June 20
===================

Summary
-------
* More twiddling with profile fits


Generating "addback" regions (vs. cutback...)
May introduce slight rotation to improve fit quality =/...

Regions could stand to be twiddled a little more?
(numbers using regions-all numbering)
* Region 3 could be extended /drawn farther, and moved up a tiny bit
* Region 9 (4) could be split into two, narrowed up, twiddled with.
  It also benefits from a bit of rotation (try 47.15 degrees)
* Region 11 (5) is crap.  Twiddle that... but I don't know how to get around
  the faintness and multiple emission lines.  Maybe look at the spectra around
  there...
* Region 32 (7) is kinda iffy in red... hard to get a FWHM out.
  Same problem of mushiness, just a pile of mess.
  Speculatively, I wonder if messing with the energy bands would help...
* Region 37 (10) is also super ratty.  I have twiddled it alot in this addback
  iteration... copy this over to `regions-4-good` and twiddle more...

At least region 38 (11) is pretty nice...



Some remarks on function fitting:
holy shit I have a lot of knobs to twiddle.

I'm starting with the two-exponential model, with a shared `x_0` and letting
`A_u` be constrained by the other parameters.  But this is having trouble
converging consistently; it's very sensitive to twiddling...

Zeroth approach: one step fit for everything all at once.  Using the original
region 3 data (without additional data in the back / twiddling some regions).
This is the material I brought in to show Rob in the morning.

First approach: two step fit.  Freeze the location of the split `x_s`, allow
parameters x0, wu, Ad, wd, Cu, Cd to vary (6 free params).
Then, unfreeze `x_s` and try another fit.

Intervention:
1. introduce allback regions
2. smooth data and apply cut to fit domain

Second approach: as above, but also freeze the constants Cu, Cd on the first
fit attempt.  Didn't make things too much better, but less blowup.

Third approach: let Au be a fitting parameter instead of Ad.  Freeze xs, Cu, Cd
on the first runthrough.  Allow all to vary the second time.

This didn't seem to do a lot (Au either goes to zero, kills the fit, or blows
up and kills the fit, or nails it).

Fourth approach: freeze x0, xs, Cu, Cd on the first run.  Then allow all to
vary (kind of like Cd -- x0 tends to run very negative and blow up fits)

THIS MAKES A BIG IMPACT!!!!!
